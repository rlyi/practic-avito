<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Avito Clone</title>
    <link rel="stylesheet" href="~/css/home.css" />
    @RenderSection("Styles", required: false)
    @using Microsoft.AspNetCore.Http
    @inject IHttpContextAccessor HttpContextAccessor
</head>


<body>
    <!-- Общая шапка для всех страниц -->
    <header class="home-header">
        <div class="home-header-container">

            <!-- Добавленная кнопка "Главная" -->
            <a asp-controller="Home" asp-action="Index" class="home-logo-link">
                <div class="home-logo">Avito</div>
            </a>

            <div class="categories-select">
                <form asp-controller="Home" asp-action="Index" method="get" class="category-form">
                    <select name="categoryId" class="category-select" onchange="this.form.submit()">
                        <option value="">Все категории</option>
                        @foreach (var category in ViewBag.Categories as IEnumerable<Category> ??
                                                Enumerable.Empty<Category>())
                        {
                            <option value="@category.Id"
                                selected="@(Context.Request.Query["categoryId"] == category.Id.ToString())">
                                @category.Name
                            </option>
                        }
                    </select>
                    @if (!string.IsNullOrEmpty(Context.Request.Query["searchQuery"]))
                    {
                        <input type="hidden" name="searchQuery" value="@Context.Request.Query["searchQuery"]">
                    }
                    @if (Context.Request.Query.ContainsKey("categoryId"))
                    {
                        <a asp-controller="Home" asp-action="Index"
                            asp-route-searchQuery="@Context.Request.Query["searchQuery"]" class="category-reset">×</a>
                    }
                </form>
            </div>

            <div class="home-search-container">
                <form asp-controller="Home" asp-action="Index" method="get" class="home-search-form">
                    <input type="text" name="searchQuery" class="home-search-input"
                        placeholder="Найти товары или услуги" value="@Context.Request.Query["searchQuery"]">
                    <button type="submit" class="home-search-button">Найти</button>
                    @if (!string.IsNullOrEmpty(Context.Request.Query["searchQuery"]))
                    {
                        <a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary">
                            Сбросить
                        </a>
                    }
                </form>
            </div>

            @{
                // Получаем имя пользователя из сессии
                var currentUser = HttpContextAccessor.HttpContext?.Session.GetString("CurrentUser");
            }

            <!-- В шапке сайта меняем блок авторизации: -->
            <div class="home-auth-buttons">
                @if (currentUser != null)
                {
                    <a asp-controller="User" asp-action="Logout" class="home-auth-button">Выйти</a>
                }
                else
                {
                    <a asp-controller="User" asp-action="Login" class="home-auth-button">Вход</a>
                    <a asp-controller="User" asp-action="Register" class="home-auth-button">Регистрация</a>
                }
            </div>

            <!-- Блок с кнопкой размещения объявления: -->
            @if (currentUser != null)
            {
                <a asp-controller="Ad" asp-action="Create" class="home-add-button"> Разместить объявление</a>
            }
            else
            {
                <a asp-controller="User" asp-action="Login" class="home-add-button"> Разместить объявление</a>
            }

        </div>
    </header>

    <!-- Сюда подставляется содержимое конкретной страницы -->
    @RenderBody()

    <!-- Общий подвал -->
    <footer>
        <!-- Подвал сайта -->
    </footer>

    @RenderSection("Scripts", required: false)
</body>

</html>
